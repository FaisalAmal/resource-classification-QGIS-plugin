## **1. Resource Categories by Confidence**

### **Measured Resources** (Highest Confidence)
- Drillhole spacing: **Example: < 70m**
- High confidence in grade and tonnage
- Close enough to reliably estimate the deposit

### **Indicated Resources** (Medium Confidence)
- Drillhole spacing: **Example: < 100m**
- Moderate confidence
- Wider spacing = more uncertainty

### **Inferred Resources** (Lowest Confidence)
- Spacing: **Example: > 100m**
- Low confidence, exploration stage
- (Not generated by this code - you use block models for this)

---

## **2. The Three-Step Clustering Process**

### **Step 1: Distance-Based Classification**
```python
nn_distances = calculate_nearest_neighbor_distances(drillholes)
```
**What it does:** Measures distance to the nearest neighboring drillhole

**Why:** This determines the "density" of drilling - tighter spacing = better data quality

**Example:**
- Drillhole A: nearest neighbor = 65m â†’ **Measured**
- Drillhole B: nearest neighbor = 95m â†’ **Indicated**
- Drillhole C: nearest neighbor = 150m â†’ **Inferred**

---

### **Step 2: Find Connected Clusters**
```python
clusters = find_connected_clusters(measured_holes, measured_distance, min_drillholes=4)
```

**What it does:** Groups drillholes that are within threshold distance of each other

**Why:** Drillholes must be connected to form a valid resource area. Isolated single holes don't count.

**Graph Theory Approach:**
- Builds an adjacency matrix: drillholes within 71m (or 121m) are "connected"
- Uses connected components algorithm to find groups
- Filters out groups with < 4 drillholes (statistical validity)

**Example:**
```
Drillholes:  A---B---C        D---E---F---G
             (65m)(70m)       (68m)(69m)(71m)
             
Result: 2 clusters
- Cluster 1: A,B,C (3 holes) â†’ REJECTED (< 4 holes)
- Cluster 2: D,E,F,G (4 holes) â†’ VALID âœ“
```

---

## **3. Area Constraint (Geological Concept)**
## **Triangulation Concept**

### **Why Use Triangle Area?**

In mineral resource estimation, each drillhole represents an **area of influence**. The triangle area constraint ensures we don't create unrealistic polygons.

```python
max_area = distanceÂ² Ã— area_factor
# For 71m: max_area = 71Â² Ã— 0.6 = 3,020 mÂ²
```

**Geological Reasoning:**
- If drillholes are 71m apart, each drillhole represents roughly a 71m Ã— 71m area
- Triangle area > this indicates an unrealistic connection
- **area_factor = 0.6** means we allow triangles up to 60% of the grid square

**Example:**
```
Good Triangle (accepted):
    A
   /|\
  / | \ 60m edges
 /  |  \
B---+---C
   70m

Area â‰ˆ 2,100 mÂ² < 3,020 mÂ² âœ“


Bad Triangle (rejected):
    A
   /  \
  /    \ 150m edges
 /      \
B--------C
   200m

Area â‰ˆ 15,000 mÂ² > 3,020 mÂ² âœ—
```
## **Alpha Shapes Concept**
### **How Alpha Parameter Controls the Shape**

### **Small Alpha (Tight Boundary)**
```
alpha = 30m

Drillholes:              Result:
  â€¢   â€¢   â€¢              â€¢â”â”â”â€¢â”â”â”â€¢
  â€¢   â€¢   â€¢      â†’       â”ƒ       â”ƒ
  â€¢       â€¢              â”ƒ   â•±â•²  â”ƒ  (follows points,
  â€¢   â€¢   â€¢              â€¢â”â”â”  â”â”â€¢   creates concave
  â€¢   â€¢   â€¢              â€¢â”â”â”â€¢â”â”â”â€¢   areas)
```
- Rejects triangles with large circumradius
- Creates tight, concave shapes
- Follows the point pattern closely

### **Medium Alpha (Balanced)**
```
alpha = 60m

Drillholes:              Result:
  â€¢   â€¢   â€¢              â•±â”â”â”â”â”â”â”â•²
  â€¢   â€¢   â€¢      â†’      â”ƒ  â€¢   â€¢  â”ƒ  (smooth but
  â€¢       â€¢             â”ƒ â€¢   â€¢ â”ƒ   still respects
  â€¢   â€¢   â€¢              â”ƒ  â€¢   â€¢  â”ƒ   point layout)
  â€¢   â€¢   â€¢              â•²â”â”â”â”â”â”â”â•±
```
- Accepts more triangles
- Balanced between tight and smooth
- Natural boundary

### **Large Alpha (Smooth Boundary)**
```
alpha = 100m

Drillholes:              Result:
  â€¢   â€¢   â€¢              â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
  â€¢   â€¢   â€¢      â†’      â”‚  â€¢ â€¢ â€¢   â”‚  (very smooth,
  â€¢       â€¢             â”‚ â€¢     â€¢ â”‚   approaching
  â€¢   â€¢   â€¢             â”‚  â€¢ â€¢ â€¢   â”‚   convex hull)
  â€¢   â€¢   â€¢              â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â•±
```
- Accepts almost all triangles
- Creates smooth, convex shapes
- Ignores fine details

---

## **4. Edge Validation (Two Modes)**

### **Mode A: Allow Diagonals** (`allow_diagonals=True`)
```python
# Rule: At least 2 edges â‰¤ max_edge
# Longest edge can be up to 1.5 Ã— max_edge
```

**Why:** Real drilling rarely follows perfect grids. This allows:
- Grid sides: 71m âœ“
- Grid diagonals: ~100m (âˆš2 Ã— 71m â‰ˆ 100m) âœ“
- Skip connections: 142m âœ—

**Visual:**
```
Regular grid with slight deviations:
A---71m---B
|       / |
71m   100m 71m (diagonal OK)
|   /     |
C---71m---D
```

### **Mode B: Strict Orthogonal** (`allow_diagonals=False`)
```python
# Rule: ALL edges â‰¤ max_edge
```

**Why:** For perfectly regular grids, this creates cleaner, more rectilinear polygons that follow the drilling pattern exactly.

**Visual:**
```
Strict grid following:
A---71m---B
|         |
71m      71m
|         |
C---71m---D
(No diagonal connections allowed)
```

---

## **5. Sub-Cluster Detection (Isolated Areas)**

```python
sub_labels = find_sub_clusters_from_triangles(coords, valid_triangle_indices)
```

**What it does:** After creating valid triangles, checks if all drillholes in a cluster are actually connected by valid triangles

**Why This Matters:**
Sometimes drillholes pass the distance test (Step 2) but can't form valid triangles (Step 3), creating isolated groups.

**Example:**
```
Main cluster (distance-based):
A---B---C        X---Y---Z
(70m)(72m)      (140m gap)(70m)

After triangle validation:
- A,B,C: Connected by valid triangles â†’ Sub-cluster 1 âœ“
- X,Y,Z: Connected by valid triangles â†’ Sub-cluster 2 âœ“
- Gap too large between C and X â†’ Separate polygons!
```

---

## **6. Buffering Concept**

```python
polygon_buffered = base_polygon.buffer(measured_buffer)
```

**What it does:** Expands the polygon outward by a fixed distance

**Why:** 
- Represents uncertainty in drillhole locations
- Accounts for geological continuity between drillholes
- Standard practice: buffer = ~35% of spacing
  - 71m spacing â†’ 25m buffer (35%)
  - 121m spacing â†’ 50m buffer (41%)

**Visual:**
```
Base polygon (triangulated):     After 25m buffer:
    A---B                            â•±-----â•²
    |   |                          â•±   A---B  â•²
    C---D                         |    |   |    |
                                   \   C---D   â•±
                                     â•²-------â•±
```

---

## **7. Hierarchy: Measured âŠ‚ Indicated âŠ‚ Inferred**

```python
polygon_buffered = polygon_buffered.difference(measured_union)
```

**Why:** Resources are nested by confidence level

**Visual:**
```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      Inferred           â”‚  (Widest spacing)
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚   â”‚   Indicated    â”‚    â”‚  (Medium spacing)
        â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
        â”‚   â”‚  â”‚Measured â”‚   â”‚    â”‚  (Tightest spacing)
        â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Higher confidence areas are "carved out" from lower confidence areas.

---

## **Key Parameters Explained**

| Parameter | Value | Meaning |
|-----------|-------|---------|
| `measured_distance=71` | 71m | Max spacing for Measured resources |
| `indicated_distance=121` | 121m | Max spacing for Indicated resources |
| `measured_buffer=25` | 25m | Safety margin around Measured polygon |
| `indicated_buffer=50` | 50m | Safety margin around Indicated polygon |
| `min_drillholes=4` | 4 holes | Minimum for statistical validity |
| `area_factor=0.6` | 0.6 | Max triangle area = 60% of grid square |
| `edge_tolerance=1.5` | 1.5Ã— | Allows diagonals up to 1.5Ã— grid spacing |
| `allow_diagonals=True/False` | bool | Flexible vs strict edge validation |

---

## **Summary: The Complete Workflow**

1. **Measure** nearest neighbor distances
2. **Classify** drillholes by spacing (Measured/Indicated/Inferred)
3. **Group** into clusters by connectivity (min 4 holes)
4. **Triangulate** using Delaunay with area constraint
5. **Validate** triangles (area + edge rules)
6. **Detect** isolated sub-clusters
7. **Create** base polygons from valid triangles
8. **Buffer** polygons by confidence level
9. **Subtract** higher confidence from lower (nesting)
10. **Export** final resource category polygons

This approach ensures geologically realistic, statistically valid resource classifications! ğŸ¯
